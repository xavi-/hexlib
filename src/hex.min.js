(function(){var g="0.1",b,f=this,i=f.document,a=Array.prototype.join,k=Array.prototype.slice,m=Object.prototype.hasOwnProperty,c=f.hex={};function j(){}var h=c.extend=function h(s){var q=k.call(arguments,1);for(var r=0,o=q.length;r<o;r++){var n=q[r];if(!n){continue}for(var p in n){if(m.call(n,p)){s[p]=n[p]}}}return s};h(c,{create:function e(o){if(!o){throw"no parent supplied"}var n=k.call(arguments,1);j.prototype=o;var p=new j();if(!n.length){return p}n.unshift(p);return h.apply(b,n)},key:function l(){return a.call(arguments,",")},log:function d(){if(this.debug&&f.console){console.log.apply(console,arguments)}},version:g})})();(function(){var f,e=this,d=e.hex;d.extend(d,{position:function a(g){var i=g.offsetLeft,h=g.offsetTop;while(g=g.offsetParent){i+=g.offsetLeft;h+=g.offsetTop}return{x:i,y:h}},size:function b(g){return{x:g.offsetWidth,y:g.offsetHeight}},style:function c(g,i){var h;if(g.currentStyle){h=g.currentStyle[i]}else{if(e.getComputedStyle){h=document.defaultView.getComputedStyle(g,null).getPropertyValue(i)}}return h}})})();(function(){var b,d=this,h=d.document,k=Array.prototype.slice,c=d.hex;var a={};c.extend(c,{evented:{addEvent:function m(t,s){if(!this.events){this.events={}}if(this.events[t]===b){this.events[t]=[]}this.events[t].push(s);return this},trigger:function g(A){if(!this.events||!this.events[A]){return false}var B=10,t=this.events[A],z=k.call(arguments,0),w=0,u=t.length,s=false,y=z[0]=c.create(a,{type:A,preventDefault:function x(){s=true}}),C=[];while(w<u){try{while(w<u){t[w++].apply(this,z)}}catch(v){C[C.length]=v;setTimeout(function(){throw v},B++)}}return{event:y,errors:C,prevented:s,args:z}},queue:function l(s){var t=this.eventqueue;if(!t){t=this.eventqueue=[]}t[t.length]=k.call(arguments,0)},fire:function q(){var s=this.eventqueue;if(!s||!s.length){return}while(s.length){this.trigger.apply(this,s.shift())}}}});var j={getTarget:function p(){var s=this.target||this.srcElement;if(!s){return b}return(s.nodeType===3?s.parentNode:s)},inside:function o(u){var v=this.mousepos(),s=c.position(u),t=c.size(u);return(v.x>s.x&&v.x<s.x+t.x&&v.y>s.y&&v.y<s.y+t.y)},mousepos:function f(t){var s=0,v=0;if(this.pageX!==b&&this.pageY!==b){s=this.pageX;v=this.pageY}else{if(this.clientX!==b&&this.clientY!==b){s=this.clientX+h.body.scrollLeft+h.documentElement.scrollLeft;v=this.clientY+h.body.scrollTop+h.documentElement.scrollTop}}if(t){var u=c.position(t);s=s-u.x;v=v-u.y}return{x:s,y:v}},preventDefault:function e(){var s=this.event;if(s.preventDefault){s.preventDefault()}else{s.returnValue=false}}};if(h.addEventListener){var i={remove:function r(){return this.elem.removeEventListener(this.type,this.callback)}};c.extend(c,{addEvent:function m(u,t,s){function v(w){return s.call(u,c.create(w,j,{event:w}))}u.addEventListener(t,v,false);return c.create(i,{callback:v,elem:u,handler:s,type:t})},removeEvent:function n(u,t,s){u.removeEventListener(t,s,false)}})}else{if(h.attachEvent){var i={remove:function r(){return this.elem.detachEvent("on"+this.type,this.callback)}};c.extend(c,{addEvent:function m(v,u,t){function w(){var x=d.event;return t.call(v,c.extend({},x,j,{event:x}))}function s(){v.detachEvent("on"+u,w);d.detachEvent("onunload",s)}v.attachEvent("on"+u,w);d.attachEvent("onunload",s);return c.create(i,{callback:w,elem:v,handler:t,type:u})},removeEvent:function n(u,t,s){u.detachEvent("on"+t,s)}})}}})();(function(){var g,f=this,a=f.document,e=f.hex;var b=e.create(e.evented,{defaults:{type:"hexagonal",enabled:true},reorient:function c(h,i){this.origin.x=+h;this.origin.y=+i;this.root.style.left=h+"px";this.root.style.top=i+"px";this.elem.style.backgroundPosition=h+"px "+i+"px"}});e.extend(e,{grid:function d(j,q){if(!j||j.nodeType!==1){throw"no DOM element supplied"}var q=e.extend({},b.defaults,q);if(e.grid[q.type]===g){throw"hex.grid."+q.type+" does not exist"}var l=e.style(j,"position");if(l!=="relative"&&l!=="absolute"){j.style.position="relative"}if(e.style(j,"overflow")!=="hidden"){j.style.overflow="hidden"}var o=a.createElement("div");o.style.position="absolute";o.style.left="0px";o.style.top="0px";o.style.overflow="visible";j.appendChild(o);var m=e.create(b,{events:{},origin:{x:0,y:0}},e.grid[q.type],q,{elem:j,root:o});var k={x:null,y:null};var p={enabled:true,panning:false,x:null,y:null};function n(r){if(!m.enabled){return}var u=r.inside(j),y=r.mousepos(j),w={x:y.x-m.origin.x,y:y.y-m.origin.y};if(p.panning){if(p.enabled&&u){var z=w.x-p.x,x=w.y-p.y;o.style.left=z+"px";o.style.top=x+"px";j.style.backgroundPosition=z+"px "+x+"px"}return}if(!m.events.tileover&&!m.events.tileout&&!m.events.gridover&&!m.events.gridout){return}var t=m.events.tileover,A=m.events.tileout,v=m.events.gridover,s=m.events.gridout,y=r.mousepos(j),w={x:y.x-m.origin.x,y:y.y-m.origin.y};trans=m.translate(w.x,w.y);if(u&&k.x===trans.x&&k.y===trans.y){return}if(A&&k.x!==null&&k.y!==null){m.queue("tileout",k.x,k.y)}if(!u&&s&&k.x!==null&&k.y!==null){m.queue("gridout",k.x,k.y)}if(u){if(v&&k.x===null&&k.y===null){m.queue("gridover",trans.x,trans.y)}if(t){m.queue("tileover",trans.x,trans.y)}k.x=trans.x;k.y=trans.y}else{k.x=null;k.y=null}m.fire()}e.addEvent(j,"mousemove",n);e.addEvent(j,"mouseover",n);e.addEvent(j,"mouseout",n);var h={x:null,y:null};function i(w){if(!m.enabled){return}if(!w.inside(j)){return}w.preventDefault();var t=w.mousepos(j);if(!p.panning&&w.type==="mousedown"){p.panning=true;p.x=t.x-m.origin.x-m.origin.x;p.y=t.y-m.origin.y-m.origin.y;j.style.cursor="move"}if(p.panning&&w.type==="mouseup"){if(p.enabled){m.reorient(t.x-m.origin.x-p.x,t.y-m.origin.y-p.y)}p.enabled=true;p.panning=false;p.x=null;p.y=null;j.style.cursor=""}if(!m.events.tiledown&&!m.events.tileup&&!m.events.tileclick){return}var y={x:t.x-m.origin.x,y:t.y-m.origin.y},s=m.translate(y.x,y.y),v=m.events.tiledown,x=m.events.tileup,u=m.events.tileclick;if(w.type==="mousedown"){if(v){var r=m.trigger("tiledown",s.x,s.y);if(r&&r.prevented){p.enabled=false}}h.x=s.x;h.y=s.y}else{if(w.type==="mouseup"){if(x){m.queue("tileup",s.x,s.y)}if(u&&h.x===s.x&&h.y===s.y){m.queue("tileclick",s.x,s.y)}h.x=null;h.y=null;m.fire()}}}e.addEvent(j,"mousedown",i);e.addEvent(j,"mouseup",i);e.addEvent(a,"mouseup",function(r){if(!p.panning){return}m.reorient(parseInt(o.style.left),parseInt(o.style.top));p.panning=false;p.x=null;p.y=null;j.style.cursor="";if(h.x!==null&&h.y!==null&&!r.inside(j)){m.queue("gridout",h.x,h.y)}h.x=null;h.y=null;k.x=null;k.y=null;m.fire()});if(m.init){m.init()}return m}})})();(function(){var e,b=this,a=b.hex;var c=a.create(a.evented);a.extend(a,{region:function d(g,f){if(!g){throw"no grid was supplied"}var f=a.extend({},f);if(typeof f.inside!=="function"){throw"options.inside is not a function"}var i=a.create(c,f,{grid:g});var j=false;g.addEvent("tileover",function(m,l,n){var k=i.inside(l,n);if(k!==j){i.trigger(k?"regionover":"regionout",l,n)}j=k});g.addEvent("gridout",function(l,k,m){if(j){i.trigger("regionout",k,m)}j=false});var h=false;g.addEvent("tiledown",function(m,l,n){var k=i.inside(l,n);if(k){i.trigger("regiondown",l,n)}h=k});g.addEvent("tileup",function(l,k,m){if(i.inside(k,m)){i.trigger("regionup",k,m);if(h){i.trigger("regionclick",k,m)}}});return i}})})();(function(){var c,g=this,d=g.hex;var a={};var j={defaults:{delay:100,repeat:false},animate:function b(t){t=d.extend({},j.defaults,t);var m=this.elem,r=this.coords,s=r[0],q=r[1],o=r[2],l=this.sprite.spritemap.width,k=t.repeat,n=0;var p=this.timeout=g.setInterval(function(){n++;if(n>=o){if(k){n=0}else{g.clearTimeout(p);return}}m.style.left=(-(s+n)*l)+"px"},t.delay)},stop:function h(){g.clearTimeout(this.timeout)}};var f={defaults:{},sprite:function i(){var v=d.create(a,{spritemap:this});var k=v.base=document.createElement("div");k.className="sprite";d.extend(k.style,{position:"relative",overflow:"hidden",width:this.width+"px",height:this.height+"px"});var o=v.layers=[];for(var p=0,n=arguments.length;p<n;p++){var q=arguments[p],t=this.map[q],u=t[0],r=t[1],m=document.createElement("div");o[p]=d.create(j,{type:q,elem:m,sprite:v,coords:t});d.extend(m.style,{position:"absolute",width:this.mapwidth+"px",height:this.mapheight+"px",top:(-r*this.height)+"px",left:(-u*this.width)+"px",backgroundImage:"url('"+this.url+"')",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.url+"', sizingMethod='crop')"});k.appendChild(m)}return v}};d.extend(d,{spritemap:function e(n){if(n===c){throw"no options hash was supplied"}n=d.extend({},f.defaults,n);var p=n.map,l=0,r=0;for(var m in p){var o=p[m];if(o[0]>l){l=o[0]}if(o[1]>r){r=o[1]}}var q=d.create(f,{mapwidth:((l+1)*n.width),mapheight:((r+1)*n.height),},n);return q}})})();(function(){var g,d=this,c=Math.floor,b=d.hex;b.grid.hexagonal={quadrant:function a(i,n){var j=this.tileWidth,l=this.tileHeight,m=c((i-j*0.25)/(j*0.75)),k=c((n)/l);return{x:m,y:k}},screenpos:function f(l,k){var i=this.tileWidth*0.75,j=this.tileHeight,n=l*i,m=-k*j-l*j*0.5;return{x:n,y:m}},tileHeight:42,tileWidth:48,translate:function e(t,r){var n=this.tileWidth*0.5,k=n*0.5,A=k*3,p=this.tileHeight,s=p*0.5,j=s/k;var i=this.quadrant(t,r),o=i.x,l=i.y;var z=(t-k)%A,w=(r)%p;if(z<0){z+=A}if(w<0){w+=p}z-=n;if(o%2){var v=o,u=(1-o)*0.5-l-(w>s?1:0);if(z<=0||w==s){return{x:v,y:u}}if(w<s&&w>(s-z*j)){return{x:v+1,y:u-1}}if(w>s&&w<(s+z*j)){return{x:v+1,y:u}}}else{var v=o,u=-o*0.5-l;if(z<=0||w==s){return{x:v,y:u}}if(w<s&&w<z*j){return{x:v+1,y:u}}if(w>s&&w>(p-z*j)){return{x:v+1,y:u-1}}}return{x:v,y:u}}}})();(function(){var g,d=this,a=Math.ceil,c=Math.floor,b=d.hex;b.grid.rectangular={screenpos:function f(i,h){return{x:i*this.tileWidth,y:-h*this.tileHeight}},tileHeight:48,tileWidth:48,translate:function e(h,i){return{x:c(h/this.tileWidth),y:a(-i/this.tileHeight)}}}})();(function(){var g,c=this,b=Math.floor,a=c.hex;a.grid.skew={e1:{x:21,y:-36},e2:{x:-21,y:-36},init:function f(){var j=this.e1.x,p=this.e1.y,h=this.e2.x,o=this.e2.y;if(j*o===h*p){throw"incomputable coefficient"}this.coefficient=1/(j*o-h*p);var k=[j,j+h,h],r=[p,p+o,o],n=0,s=0,m=0,q=0;for(var l=0;l<3;l++){if(k[l]>n){n=k[l]}if(k[l]<s){s=k[l]}if(r[l]>m){m=r[l]}if(r[l]<q){q=r[l]}}this.tileWidth=n-s;this.tileHeight=m-q;this.offset={x:-s,y:-q}},screenpos:function e(h,i){return{x:(h*this.e1.x+i*this.e2.x),y:(h*this.e1.y+i*this.e2.y)}},translate:function d(h,j){var i=this.coefficient;h=h-this.offset.x;j=j-this.offset.y;return{x:b(i*(h*this.e2.y-j*this.e2.x)),y:b(i*(j*this.e1.x-h*this.e1.y))}}}})();(function(){var g,c=this,b=Math.floor,a=c.hex;a.grid.triangular={tileHeight:48,tileWidth:56,init:function f(){var j=this.tileHeight,i=this.tileWidth;this.e1={x:i,y:0};this.e2={x:i*0.5,y:-j};a.grid.skew.init.call(this);this.tileHeight=j;this.tileWidth=i},screenpos:function e(h,i){return a.grid.skew.screenpos.call(this,h*0.5,i)},translate:function d(h,o){h=h-this.offset.x;o=o-this.offset.y;var n=this.coefficient,j=n*(h*this.e2.y-o*this.e2.x),l=n*(o*this.e1.x-h*this.e1.y),i=b(j),k=b(l),m=(j+l-i-k>1?1:0);return{x:i*2+m,y:k}}}})();